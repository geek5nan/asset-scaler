---
description: User preferences and guidelines based on development iterations
---

# ResBeaver 开发偏好指南

基于开发迭代总结出的偏好、规则和准则。

---

## 🎯 核心设计原则

### 1. SOT (Single Source of Truth) 原则
- **避免重复逻辑**,提取为工具函数统一管理
- 相同的排序、过滤、转换逻辑只定义一次
- 修改只需在一处进行,确保行为一致性
- 示例:`sortMappingsByTargetFolder()`, `generateMappingsFromFiles()`

### 2. 用户控制优先
- **避免自动执行**,让用户确认后再执行关键操作
- 长时间操作不应自动完成,应等待用户确认
- 用户应能清楚地看到操作的完整过程和结果
- 示例:导入完成后显示"确认"按钮,而非自动刷新

### 3. 一致性行为
- **不同触发方式应产生相同效果**
- 对话框的所有关闭方式(ESC、关闭按钮、确认按钮)在完成状态下行为一致
- 键盘快捷键和按钮点击应触发相同逻辑

### 4. 与外部工具对齐
- 列表排序应与 **Android Studio** 保持一致
- 使用 targetFolder (locale) 排序,如:values, values-ar, values-zh
- 确保整个数据流保持相同顺序:mappings → sourceResources → preview → UI

---

## 🔧 UI/UX 偏好

### 进度显示模式
- 在**原对话框内**显示进度,而非在外部
- 显示当前处理项和总数 (X / Y)
- 显示当前处理的文件名
- 完成后显示明确的完成状态 ("✓ 导入完成")
- 按钮状态随流程变化:
  - 导入中:按钮禁用,显示"导入中..."
  - 完成后:按钮变为"确认"

### 按钮状态管理
- **主界面按钮不显示 loading 状态**
- 进度反馈集中在弹窗/对话框内
- 主按钮始终可用(除非无数据可操作)

### 列表自动选择
- 默认选中**排序后的第一项**
- 保持选择的一致性,即使数据刷新

### 快捷键支持
- N/P 键用于导航(下一个/上一个)
- 支持循环导航(最后一项按N跳到第一项)
- ESC 关闭对话框

---

## 💻 代码风格与架构

### 避免侵入性改动
- 使用第三方工具(如 shadcn CLI)时,**检查并还原不必要的样式改动**
- 保持项目原有的颜色主题和配置
- 不要让工具自动覆盖现有配置

### 条件逻辑
- **智能判断**:如无实际变更,不执行额外操作
- 示例:只有在有新增/更新时才插入注释
- 避免不必要的文件写入和DOM更新

### useEffect 依赖管理
- 确保依赖数组**完整**,避免闭包陷阱
- 注意函数定义顺序,被引用的函数需先定义
- useCallback 的依赖项也需正确设置

### 状态管理
- 使用明确的状态变量控制 UI 流程
- 避免使用计时器自动关闭,使用状态标记
- 示例:`importCompleted` 控制完成状态

---

## 📋 对话框流程模式

### 标准操作流程
```
用户点击操作按钮
  ↓
打开确认对话框
  ↓
用户点击确认 → 开始操作
  ↓
显示进度条 + 当前处理项 (在对话框内)
  ↓
完成 → 显示完成状态
  ↓
按钮变为"确认",隐藏"取消"
  ↓
用户点击确认(或ESC/关闭) → 执行刷新 → 关闭对话框
```

### 对话框关闭行为
- 操作进行中:禁止关闭
- 操作完成后:所有关闭方式触发相同的确认逻辑

---

## ⚠️ 注意事项与避坑指南

1. **不要过度使用第三方工具的初始化命令** - 可能覆盖项目配置(如 shadcn init)
2. **列表顺序一致性** - 确保数据流经过的每个环节顺序一致
3. **用户反馈透明** - 用户应能看到操作的完整过程
4. **关闭方式统一** - 对话框的所有关闭方式应产生相同效果
5. **依赖项完整性** - useEffect/useCallback 的依赖数组必须完整
6. **函数定义顺序** - 被引用的 useCallback 需在使用前定义

---

## 🔄 刷新逻辑

### 何时刷新
- 用户手动点击刷新按钮
- 导入操作完成且用户确认后
- 切换项目/模块时

### 刷新后保持
- 保持当前选中项(如果仍存在)
- 保持滚动位置(如适用)
- 保持展开/折叠状态

---

## 📝 命名规范

### 状态变量
- `showXxxDialog` - 控制对话框显示
- `xxxCompleted` - 标记操作完成状态
- `isXxxing` - 标记操作进行中

### 处理函数
- `handleXxx` - 事件处理函数
- `onXxx` - 作为 props 传递的回调
